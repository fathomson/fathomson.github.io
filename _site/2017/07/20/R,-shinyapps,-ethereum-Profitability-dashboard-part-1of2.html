<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>
      
      R, ethereum, shinyapps - Profitability dashboard part 1 of 2
      
    </title>
    <link rel="shortcut icon" type="image/x-icon" href="/assets/res/favicon.ico">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/materialize/0.99.0/css/materialize.min.css">
    <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="/assets/css/main.css">
    
    
    <link rel="stylesheet" href="/assets/css/post.css">
    
    
    
    <link rel="stylesheet" href="/assets/css/syntax.css">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml">
    <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml">
    <!-- Begin Jekyll SEO tag v2.2.3 -->
<meta property="og:title" content="R, ethereum, shinyapps - Profitability dashboard part 1 of 2" />
<meta name="author" content="Frank Thomson" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The cryptocurrency Ethereum now reaches the news headlines on a daily basis. It has attracted a lot of new miners who often seek a way to earn a quick buck, but how profitable is the mining of this digital currency? To find out I walk you thought the steps I took to develop a profitability calculator dashboard. It consists out of two parts, the first part focusses on the data collection and preparation and in the second part I will handle the dashboard development. Collect data The first step is to get the full ether block chain to collect the data from, so I downloaded and installed geth. #create account geth account new #sync chain and start rpc geth --rpc --rpccorsdomain localhost --cache=1024 This took quite a while and you could speed it up by downloading a so-called backup file of the chain which are available online. While this process runs you can already start collecting block data. Do note that the full size of the chain currently is about 60GB and counting. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38# json rpc api functions. # thanks to: https://github.com/BSDStudios/ethr # json-rpc documentation: https://github.com/ethereum/wiki/wiki/JSON-RPC # Returns the number of most recent block. eth_blockNumber &lt;- function(rpc_address = &quot;http://localhost:8545&quot;) { post_body &lt;- list(jsonrpc = &quot;2.0&quot;, method = &quot;eth_blockNumber&quot;, params = &quot;&quot;, id = 83) post_return &lt;- httr::POST(url = rpc_address, body = post_body, encode = &quot;json&quot;) post_content &lt;- httr::content(post_return, as = &quot;parsed&quot;) block_number &lt;- post_content$result return(block_number) } # Returns information about a block by block number. eth_getBlockByNumber &lt;-function(block_number, full_list, rpc_address = &quot;http://localhost:8545&quot;) { block_number &lt;- as.character(block_number) full_list &lt;- as.logical(full_list) body &lt;- list(jsonrpc = &quot;2.0&quot;, method = &quot;eth_getBlockByNumber&quot;, params = list(block_number, full_list), id = 1) block_return &lt;- httr::POST(url = rpc_address, body = body, encode = &quot;json&quot;) block_dat &lt;- httr::content(block_return)$result return(block_dat) } # Returns the receipt of a transaction by transaction hash. eth_getTransactionReceipt &lt;- function(transaction_hash, rpc_address = &quot;http://localhost:8545&quot;) { body &lt;- list(jsonrpc = &quot;2.0&quot;, method = &quot;eth_getTransactionReceipt&quot;, params = list(transaction_hash), id = 1) TransReceipt_return &lt;- httr::POST(url = rpc_address, body = body, encode = &quot;json&quot;) TransReceipt &lt;- httr::content(TransReceipt_return)$result return(TransReceipt) } # Returns information about a uncle of a block by number and uncle index position. eth_getUncleByBlockNumberAndIndex &lt;- function(block_number, index, rpc_address = &quot;http://localhost:8545&quot;) { body &lt;- list(jsonrpc = &quot;2.0&quot;, method = &quot;eth_getUncleByBlockNumberAndIndex&quot;, params = list(block_number, index), id = 1) UncleBlock_return &lt;- httr::POST(url = rpc_address, body = body, encode = &quot;json&quot;) UncleBlock &lt;- httr::content(UncleBlock_return)$result return(UncleBlock) } Transform data The data as received from the functions defined above is not directly suitable. It needs to be transformed and enriched in order to be of use. The functions below help us transforming the data. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51# hex -&gt; numeric getNumber &lt;- function(hex){ class(hex) &lt;- &quot;numeric&quot; return(as.numeric(sprintf(&quot;%.0f&quot;,hex))) } # numeric -&gt; hex getHex &lt;- function(number){ return(paste0(&quot;0x&quot;,sprintf(&quot;%x&quot;,number))) } # Enrich block data with: uncle and transaction details. enrichETHblock &lt;- function(hexBlock){ # default block reward, amount transactionfees and total ether of transactions in block. blockReward &lt;- 5 txFees &lt;- 0 ethValue &lt;- 0 # sum all transactionfees for(transaction in hexBlock$transactions){ ethValue &lt;- ethValue + getNumber(transaction$value)/1e18 tr &lt;- eth_getTransactionReceipt(transaction$hash) if(is.null(tr)) next txFees &lt;- txFees + getNumber(tr$gasUsed) * (getNumber(transaction$gasPrice)/1e18) } # sum total uncle rewards uncleETH &lt;- 0 for(i in 0:1){ uncle &lt;- eth_getUncleByBlockNumberAndIndex(hexBlock$number,getHex(i)) if(!is.null(uncle)) uncleETH &lt;- uncleETH + ((8-(getNumber(hexBlock$number) - getNumber(uncle$number)))/8) * blockReward } # miner reward for included uncle minerRewardUncle &lt;- length(hexBlock$uncles) * 1/32 * blockReward # wrap in dataframe block &lt;- data.frame(number = getNumber(hexBlock$number), timestamp = as.POSIXct(getNumber(hexBlock$timestamp), origin=&quot;1970-01-01&quot;), difficulty= getNumber(hexBlock$difficulty), txCount = length(hexBlock$transactions), txEther = ethValue, txFees = txFees, uncleETH = uncleETH, minerUncleReward = minerRewardUncle, totalETHreward = blockReward + txFees + minerRewardUncle + uncleETH) return(block) } Save data Ok, now we have collected the data and we can transform it into the format we want. The next step is saving the transformed data for our future analysis. I have chosen for a local instance of SQL to write the data to. If you do not have an instance of SQL on your machine download it and create a database add a table. I have named my table eth_blocks and it can be created with the following statement: CREATE TABLE eth_blocks( [number] [int] NULL, [timestamp] [datetime] NULL, [difficulty] [bigint] NULL, [txCount] [int] NULL, [txEther] [decimal](24, 16) NULL, [txFees] [decimal](24, 16) NULL, [uncleETH] [decimal](24, 16) NULL, [minerUncleReward] [decimal](24, 16) NULL, [totalETHreward] [decimal](24, 16) NULL ) Once the table is created we need to be able to write the data from R into SQL. The are two beautiful R libraries available to help us achieve that namely: library(RODBC) library(RODBCext) # parameterizes queries # Define an ODBC datasource and you can easily connect to your database dbHandle &lt;-odbcConnect(&quot;[database-name]&quot;) Once everything is set up we can start the script that actually collects the data, transforms it and finally saves it into the database. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69# script start time start.time &lt;- Sys.time() # create database handle ODBS data source dbHandle &lt;-odbcConnect(&quot;ethereum&quot;) # get the latest block in database maxBlockInDB &lt;- sqlQuery(dbHandle, &quot;select top 1 number from eth_blocks order by number desc&quot;) maxBlockInDB &lt;- as.numeric(maxBlockInDB) # when no block is found, assume that there are no block in the db yet if(is.na(maxBlockInDB[1])) maxBlockInDB &lt;- 0 # start block is latest block in db + 1 startBlock &lt;- maxBlockInDB + 1 # stop block is last block in chain stopBlock &lt;- getNumber(eth_blockNumber()) # blocks that will be added in this session. 1 when stopblock and startblok are equal. print(paste0(&quot;Starting update operation, blocks to add: : &quot;,stopBlock -maxBlockInDB )) # get new blocks from chain and write to database for (i in startBlock:stopBlock){ # get block i from chain block &lt;- eth_getBlockByNumber(getHex(i), TRUE) if(is.null(block)) break # convert to database format and save in database. rBlock &lt;- enrichETHblock(block) RODBCext::sqlExecute(dbHandle, &quot;INSERT INTO eth_blocks VALUES (?,?,?,?,?,?,?,?,?)&quot;, rBlock) # once every 500 blocks show status messuge if(i %% 500 == 1){ end.time &lt;- Sys.time() time.taken &lt;- end.time - start.time print(paste0(&quot;Current block : &quot;,i,&quot; Operation took:&quot;, as.numeric(time.taken) )) start.time &lt;- Sys.time() } } # when done show status message again. print(paste0(&quot;Done! added: : &quot;,stopBlock -maxBlockInDB,&quot; blocks&quot; )) # when done retrieve all blocks from the database allBlocks &lt;- sqlQuery(dbHandle, &quot;select * from eth_blocks order by number asc&quot;) # aggregate block data dailyDifficulty &lt;- allBlocks %&gt;% dplyr::mutate(toTimestamp = dplyr::lead(timestamp)) %&gt;% dplyr::mutate(duration = as.numeric(difftime(toTimestamp,timestamp, units = &quot;secs&quot;))) %&gt;% dplyr::mutate(weigthedDifficulty = difficulty*duration) %&gt;% dplyr::group_by(Day = as.Date(format(as.Date(timestamp, &quot;%d/%m/%Y&quot;)))) %&gt;% dplyr::summarise(netHash = sum(weigthedDifficulty)/sum(duration) / mean(duration), avgBlocktime = mean(duration), ethFromBlocks = n()*5, ethFromUnclesForMiner = sum(uncleETH), ethFromUnclesForIncluder = sum(minerUncleReward), ethFromtxFees = sum(txFees), ethTotal = sum(ethFromBlocks,ethFromUnclesForMiner,ethFromUnclesForIncluder,ethFromtxFees)) # RStudio filedir # write to dashboard dir dir &lt;- dirname(rstudioapi::getActiveDocumentContext()$path) saveRDS(dailyDifficulty, paste0(dir, &quot;/dashboard/data/daily.Rda&quot;)) # clode db connection odbcCloseAll() As you notice in the end I save the aggregated data file (daily.Rda) in a separate folder. This data file will be used for our dashboard which I discuss in part 2. Useful links Project source code Report issues Questions/contact" />
<meta property="og:description" content="The cryptocurrency Ethereum now reaches the news headlines on a daily basis. It has attracted a lot of new miners who often seek a way to earn a quick buck, but how profitable is the mining of this digital currency? To find out I walk you thought the steps I took to develop a profitability calculator dashboard. It consists out of two parts, the first part focusses on the data collection and preparation and in the second part I will handle the dashboard development. Collect data The first step is to get the full ether block chain to collect the data from, so I downloaded and installed geth. #create account geth account new #sync chain and start rpc geth --rpc --rpccorsdomain localhost --cache=1024 This took quite a while and you could speed it up by downloading a so-called backup file of the chain which are available online. While this process runs you can already start collecting block data. Do note that the full size of the chain currently is about 60GB and counting. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38# json rpc api functions. # thanks to: https://github.com/BSDStudios/ethr # json-rpc documentation: https://github.com/ethereum/wiki/wiki/JSON-RPC # Returns the number of most recent block. eth_blockNumber &lt;- function(rpc_address = &quot;http://localhost:8545&quot;) { post_body &lt;- list(jsonrpc = &quot;2.0&quot;, method = &quot;eth_blockNumber&quot;, params = &quot;&quot;, id = 83) post_return &lt;- httr::POST(url = rpc_address, body = post_body, encode = &quot;json&quot;) post_content &lt;- httr::content(post_return, as = &quot;parsed&quot;) block_number &lt;- post_content$result return(block_number) } # Returns information about a block by block number. eth_getBlockByNumber &lt;-function(block_number, full_list, rpc_address = &quot;http://localhost:8545&quot;) { block_number &lt;- as.character(block_number) full_list &lt;- as.logical(full_list) body &lt;- list(jsonrpc = &quot;2.0&quot;, method = &quot;eth_getBlockByNumber&quot;, params = list(block_number, full_list), id = 1) block_return &lt;- httr::POST(url = rpc_address, body = body, encode = &quot;json&quot;) block_dat &lt;- httr::content(block_return)$result return(block_dat) } # Returns the receipt of a transaction by transaction hash. eth_getTransactionReceipt &lt;- function(transaction_hash, rpc_address = &quot;http://localhost:8545&quot;) { body &lt;- list(jsonrpc = &quot;2.0&quot;, method = &quot;eth_getTransactionReceipt&quot;, params = list(transaction_hash), id = 1) TransReceipt_return &lt;- httr::POST(url = rpc_address, body = body, encode = &quot;json&quot;) TransReceipt &lt;- httr::content(TransReceipt_return)$result return(TransReceipt) } # Returns information about a uncle of a block by number and uncle index position. eth_getUncleByBlockNumberAndIndex &lt;- function(block_number, index, rpc_address = &quot;http://localhost:8545&quot;) { body &lt;- list(jsonrpc = &quot;2.0&quot;, method = &quot;eth_getUncleByBlockNumberAndIndex&quot;, params = list(block_number, index), id = 1) UncleBlock_return &lt;- httr::POST(url = rpc_address, body = body, encode = &quot;json&quot;) UncleBlock &lt;- httr::content(UncleBlock_return)$result return(UncleBlock) } Transform data The data as received from the functions defined above is not directly suitable. It needs to be transformed and enriched in order to be of use. The functions below help us transforming the data. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51# hex -&gt; numeric getNumber &lt;- function(hex){ class(hex) &lt;- &quot;numeric&quot; return(as.numeric(sprintf(&quot;%.0f&quot;,hex))) } # numeric -&gt; hex getHex &lt;- function(number){ return(paste0(&quot;0x&quot;,sprintf(&quot;%x&quot;,number))) } # Enrich block data with: uncle and transaction details. enrichETHblock &lt;- function(hexBlock){ # default block reward, amount transactionfees and total ether of transactions in block. blockReward &lt;- 5 txFees &lt;- 0 ethValue &lt;- 0 # sum all transactionfees for(transaction in hexBlock$transactions){ ethValue &lt;- ethValue + getNumber(transaction$value)/1e18 tr &lt;- eth_getTransactionReceipt(transaction$hash) if(is.null(tr)) next txFees &lt;- txFees + getNumber(tr$gasUsed) * (getNumber(transaction$gasPrice)/1e18) } # sum total uncle rewards uncleETH &lt;- 0 for(i in 0:1){ uncle &lt;- eth_getUncleByBlockNumberAndIndex(hexBlock$number,getHex(i)) if(!is.null(uncle)) uncleETH &lt;- uncleETH + ((8-(getNumber(hexBlock$number) - getNumber(uncle$number)))/8) * blockReward } # miner reward for included uncle minerRewardUncle &lt;- length(hexBlock$uncles) * 1/32 * blockReward # wrap in dataframe block &lt;- data.frame(number = getNumber(hexBlock$number), timestamp = as.POSIXct(getNumber(hexBlock$timestamp), origin=&quot;1970-01-01&quot;), difficulty= getNumber(hexBlock$difficulty), txCount = length(hexBlock$transactions), txEther = ethValue, txFees = txFees, uncleETH = uncleETH, minerUncleReward = minerRewardUncle, totalETHreward = blockReward + txFees + minerRewardUncle + uncleETH) return(block) } Save data Ok, now we have collected the data and we can transform it into the format we want. The next step is saving the transformed data for our future analysis. I have chosen for a local instance of SQL to write the data to. If you do not have an instance of SQL on your machine download it and create a database add a table. I have named my table eth_blocks and it can be created with the following statement: CREATE TABLE eth_blocks( [number] [int] NULL, [timestamp] [datetime] NULL, [difficulty] [bigint] NULL, [txCount] [int] NULL, [txEther] [decimal](24, 16) NULL, [txFees] [decimal](24, 16) NULL, [uncleETH] [decimal](24, 16) NULL, [minerUncleReward] [decimal](24, 16) NULL, [totalETHreward] [decimal](24, 16) NULL ) Once the table is created we need to be able to write the data from R into SQL. The are two beautiful R libraries available to help us achieve that namely: library(RODBC) library(RODBCext) # parameterizes queries # Define an ODBC datasource and you can easily connect to your database dbHandle &lt;-odbcConnect(&quot;[database-name]&quot;) Once everything is set up we can start the script that actually collects the data, transforms it and finally saves it into the database. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69# script start time start.time &lt;- Sys.time() # create database handle ODBS data source dbHandle &lt;-odbcConnect(&quot;ethereum&quot;) # get the latest block in database maxBlockInDB &lt;- sqlQuery(dbHandle, &quot;select top 1 number from eth_blocks order by number desc&quot;) maxBlockInDB &lt;- as.numeric(maxBlockInDB) # when no block is found, assume that there are no block in the db yet if(is.na(maxBlockInDB[1])) maxBlockInDB &lt;- 0 # start block is latest block in db + 1 startBlock &lt;- maxBlockInDB + 1 # stop block is last block in chain stopBlock &lt;- getNumber(eth_blockNumber()) # blocks that will be added in this session. 1 when stopblock and startblok are equal. print(paste0(&quot;Starting update operation, blocks to add: : &quot;,stopBlock -maxBlockInDB )) # get new blocks from chain and write to database for (i in startBlock:stopBlock){ # get block i from chain block &lt;- eth_getBlockByNumber(getHex(i), TRUE) if(is.null(block)) break # convert to database format and save in database. rBlock &lt;- enrichETHblock(block) RODBCext::sqlExecute(dbHandle, &quot;INSERT INTO eth_blocks VALUES (?,?,?,?,?,?,?,?,?)&quot;, rBlock) # once every 500 blocks show status messuge if(i %% 500 == 1){ end.time &lt;- Sys.time() time.taken &lt;- end.time - start.time print(paste0(&quot;Current block : &quot;,i,&quot; Operation took:&quot;, as.numeric(time.taken) )) start.time &lt;- Sys.time() } } # when done show status message again. print(paste0(&quot;Done! added: : &quot;,stopBlock -maxBlockInDB,&quot; blocks&quot; )) # when done retrieve all blocks from the database allBlocks &lt;- sqlQuery(dbHandle, &quot;select * from eth_blocks order by number asc&quot;) # aggregate block data dailyDifficulty &lt;- allBlocks %&gt;% dplyr::mutate(toTimestamp = dplyr::lead(timestamp)) %&gt;% dplyr::mutate(duration = as.numeric(difftime(toTimestamp,timestamp, units = &quot;secs&quot;))) %&gt;% dplyr::mutate(weigthedDifficulty = difficulty*duration) %&gt;% dplyr::group_by(Day = as.Date(format(as.Date(timestamp, &quot;%d/%m/%Y&quot;)))) %&gt;% dplyr::summarise(netHash = sum(weigthedDifficulty)/sum(duration) / mean(duration), avgBlocktime = mean(duration), ethFromBlocks = n()*5, ethFromUnclesForMiner = sum(uncleETH), ethFromUnclesForIncluder = sum(minerUncleReward), ethFromtxFees = sum(txFees), ethTotal = sum(ethFromBlocks,ethFromUnclesForMiner,ethFromUnclesForIncluder,ethFromtxFees)) # RStudio filedir # write to dashboard dir dir &lt;- dirname(rstudioapi::getActiveDocumentContext()$path) saveRDS(dailyDifficulty, paste0(dir, &quot;/dashboard/data/daily.Rda&quot;)) # clode db connection odbcCloseAll() As you notice in the end I save the aggregated data file (daily.Rda) in a separate folder. This data file will be used for our dashboard which I discuss in part 2. Useful links Project source code Report issues Questions/contact" />
<link rel="canonical" href="http://localhost:4000/2017/07/20/R,-shinyapps,-ethereum-Profitability-dashboard-part-1of2" />
<meta property="og:url" content="http://localhost:4000/2017/07/20/R,-shinyapps,-ethereum-Profitability-dashboard-part-1of2" />
<meta property="og:site_name" content="Technical blog about R, block chain and more" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-07-20T12:30:13+02:00" />
<meta name="google-site-verification" content="UA-101946097-1" />
<script type="application/ld+json">
{"@context":"http://schema.org","@type":"BlogPosting","headline":"R, ethereum, shinyapps - Profitability dashboard part 1 of 2","author":{"@type":"Person","name":"Frank Thomson"},"datePublished":"2017-07-20T12:30:13+02:00","dateModified":"2017-07-20T12:30:13+02:00","description":"The cryptocurrency Ethereum now reaches the news headlines on a daily basis. It has attracted a lot of new miners who often seek a way to earn a quick buck, but how profitable is the mining of this digital currency? To find out I walk you thought the steps I took to develop a profitability calculator dashboard. It consists out of two parts, the first part focusses on the data collection and preparation and in the second part I will handle the dashboard development. Collect data The first step is to get the full ether block chain to collect the data from, so I downloaded and installed geth. #create account geth account new #sync chain and start rpc geth --rpc --rpccorsdomain localhost --cache=1024 This took quite a while and you could speed it up by downloading a so-called backup file of the chain which are available online. While this process runs you can already start collecting block data. Do note that the full size of the chain currently is about 60GB and counting. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38# json rpc api functions. # thanks to: https://github.com/BSDStudios/ethr # json-rpc documentation: https://github.com/ethereum/wiki/wiki/JSON-RPC # Returns the number of most recent block. eth_blockNumber &lt;- function(rpc_address = &quot;http://localhost:8545&quot;) { post_body &lt;- list(jsonrpc = &quot;2.0&quot;, method = &quot;eth_blockNumber&quot;, params = &quot;&quot;, id = 83) post_return &lt;- httr::POST(url = rpc_address, body = post_body, encode = &quot;json&quot;) post_content &lt;- httr::content(post_return, as = &quot;parsed&quot;) block_number &lt;- post_content$result return(block_number) } # Returns information about a block by block number. eth_getBlockByNumber &lt;-function(block_number, full_list, rpc_address = &quot;http://localhost:8545&quot;) { block_number &lt;- as.character(block_number) full_list &lt;- as.logical(full_list) body &lt;- list(jsonrpc = &quot;2.0&quot;, method = &quot;eth_getBlockByNumber&quot;, params = list(block_number, full_list), id = 1) block_return &lt;- httr::POST(url = rpc_address, body = body, encode = &quot;json&quot;) block_dat &lt;- httr::content(block_return)$result return(block_dat) } # Returns the receipt of a transaction by transaction hash. eth_getTransactionReceipt &lt;- function(transaction_hash, rpc_address = &quot;http://localhost:8545&quot;) { body &lt;- list(jsonrpc = &quot;2.0&quot;, method = &quot;eth_getTransactionReceipt&quot;, params = list(transaction_hash), id = 1) TransReceipt_return &lt;- httr::POST(url = rpc_address, body = body, encode = &quot;json&quot;) TransReceipt &lt;- httr::content(TransReceipt_return)$result return(TransReceipt) } # Returns information about a uncle of a block by number and uncle index position. eth_getUncleByBlockNumberAndIndex &lt;- function(block_number, index, rpc_address = &quot;http://localhost:8545&quot;) { body &lt;- list(jsonrpc = &quot;2.0&quot;, method = &quot;eth_getUncleByBlockNumberAndIndex&quot;, params = list(block_number, index), id = 1) UncleBlock_return &lt;- httr::POST(url = rpc_address, body = body, encode = &quot;json&quot;) UncleBlock &lt;- httr::content(UncleBlock_return)$result return(UncleBlock) } Transform data The data as received from the functions defined above is not directly suitable. It needs to be transformed and enriched in order to be of use. The functions below help us transforming the data. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51# hex -&gt; numeric getNumber &lt;- function(hex){ class(hex) &lt;- &quot;numeric&quot; return(as.numeric(sprintf(&quot;%.0f&quot;,hex))) } # numeric -&gt; hex getHex &lt;- function(number){ return(paste0(&quot;0x&quot;,sprintf(&quot;%x&quot;,number))) } # Enrich block data with: uncle and transaction details. enrichETHblock &lt;- function(hexBlock){ # default block reward, amount transactionfees and total ether of transactions in block. blockReward &lt;- 5 txFees &lt;- 0 ethValue &lt;- 0 # sum all transactionfees for(transaction in hexBlock$transactions){ ethValue &lt;- ethValue + getNumber(transaction$value)/1e18 tr &lt;- eth_getTransactionReceipt(transaction$hash) if(is.null(tr)) next txFees &lt;- txFees + getNumber(tr$gasUsed) * (getNumber(transaction$gasPrice)/1e18) } # sum total uncle rewards uncleETH &lt;- 0 for(i in 0:1){ uncle &lt;- eth_getUncleByBlockNumberAndIndex(hexBlock$number,getHex(i)) if(!is.null(uncle)) uncleETH &lt;- uncleETH + ((8-(getNumber(hexBlock$number) - getNumber(uncle$number)))/8) * blockReward } # miner reward for included uncle minerRewardUncle &lt;- length(hexBlock$uncles) * 1/32 * blockReward # wrap in dataframe block &lt;- data.frame(number = getNumber(hexBlock$number), timestamp = as.POSIXct(getNumber(hexBlock$timestamp), origin=&quot;1970-01-01&quot;), difficulty= getNumber(hexBlock$difficulty), txCount = length(hexBlock$transactions), txEther = ethValue, txFees = txFees, uncleETH = uncleETH, minerUncleReward = minerRewardUncle, totalETHreward = blockReward + txFees + minerRewardUncle + uncleETH) return(block) } Save data Ok, now we have collected the data and we can transform it into the format we want. The next step is saving the transformed data for our future analysis. I have chosen for a local instance of SQL to write the data to. If you do not have an instance of SQL on your machine download it and create a database add a table. I have named my table eth_blocks and it can be created with the following statement: CREATE TABLE eth_blocks( [number] [int] NULL, [timestamp] [datetime] NULL, [difficulty] [bigint] NULL, [txCount] [int] NULL, [txEther] [decimal](24, 16) NULL, [txFees] [decimal](24, 16) NULL, [uncleETH] [decimal](24, 16) NULL, [minerUncleReward] [decimal](24, 16) NULL, [totalETHreward] [decimal](24, 16) NULL ) Once the table is created we need to be able to write the data from R into SQL. The are two beautiful R libraries available to help us achieve that namely: library(RODBC) library(RODBCext) # parameterizes queries # Define an ODBC datasource and you can easily connect to your database dbHandle &lt;-odbcConnect(&quot;[database-name]&quot;) Once everything is set up we can start the script that actually collects the data, transforms it and finally saves it into the database. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69# script start time start.time &lt;- Sys.time() # create database handle ODBS data source dbHandle &lt;-odbcConnect(&quot;ethereum&quot;) # get the latest block in database maxBlockInDB &lt;- sqlQuery(dbHandle, &quot;select top 1 number from eth_blocks order by number desc&quot;) maxBlockInDB &lt;- as.numeric(maxBlockInDB) # when no block is found, assume that there are no block in the db yet if(is.na(maxBlockInDB[1])) maxBlockInDB &lt;- 0 # start block is latest block in db + 1 startBlock &lt;- maxBlockInDB + 1 # stop block is last block in chain stopBlock &lt;- getNumber(eth_blockNumber()) # blocks that will be added in this session. 1 when stopblock and startblok are equal. print(paste0(&quot;Starting update operation, blocks to add: : &quot;,stopBlock -maxBlockInDB )) # get new blocks from chain and write to database for (i in startBlock:stopBlock){ # get block i from chain block &lt;- eth_getBlockByNumber(getHex(i), TRUE) if(is.null(block)) break # convert to database format and save in database. rBlock &lt;- enrichETHblock(block) RODBCext::sqlExecute(dbHandle, &quot;INSERT INTO eth_blocks VALUES (?,?,?,?,?,?,?,?,?)&quot;, rBlock) # once every 500 blocks show status messuge if(i %% 500 == 1){ end.time &lt;- Sys.time() time.taken &lt;- end.time - start.time print(paste0(&quot;Current block : &quot;,i,&quot; Operation took:&quot;, as.numeric(time.taken) )) start.time &lt;- Sys.time() } } # when done show status message again. print(paste0(&quot;Done! added: : &quot;,stopBlock -maxBlockInDB,&quot; blocks&quot; )) # when done retrieve all blocks from the database allBlocks &lt;- sqlQuery(dbHandle, &quot;select * from eth_blocks order by number asc&quot;) # aggregate block data dailyDifficulty &lt;- allBlocks %&gt;% dplyr::mutate(toTimestamp = dplyr::lead(timestamp)) %&gt;% dplyr::mutate(duration = as.numeric(difftime(toTimestamp,timestamp, units = &quot;secs&quot;))) %&gt;% dplyr::mutate(weigthedDifficulty = difficulty*duration) %&gt;% dplyr::group_by(Day = as.Date(format(as.Date(timestamp, &quot;%d/%m/%Y&quot;)))) %&gt;% dplyr::summarise(netHash = sum(weigthedDifficulty)/sum(duration) / mean(duration), avgBlocktime = mean(duration), ethFromBlocks = n()*5, ethFromUnclesForMiner = sum(uncleETH), ethFromUnclesForIncluder = sum(minerUncleReward), ethFromtxFees = sum(txFees), ethTotal = sum(ethFromBlocks,ethFromUnclesForMiner,ethFromUnclesForIncluder,ethFromtxFees)) # RStudio filedir # write to dashboard dir dir &lt;- dirname(rstudioapi::getActiveDocumentContext()$path) saveRDS(dailyDifficulty, paste0(dir, &quot;/dashboard/data/daily.Rda&quot;)) # clode db connection odbcCloseAll() As you notice in the end I save the aggregated data file (daily.Rda) in a separate folder. This data file will be used for our dashboard which I discuss in part 2. Useful links Project source code Report issues Questions/contact","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2017/07/20/R,-shinyapps,-ethereum-Profitability-dashboard-part-1of2"},"url":"http://localhost:4000/2017/07/20/R,-shinyapps,-ethereum-Profitability-dashboard-part-1of2"}</script>
<!-- End Jekyll SEO tag -->

  </head>
  <body>
    <header>
      <nav class="top-nav light-blue darken-2">
        <div class="nav-wrapper">
          <div class="container">
            <a class="page-title" href="/">Technical blog about R, block chain and more</a>
          </div>
        </div>
      </nav>
      <div class="container">
        <a href="#" data-activates="slide-out" class="button-collapse top-nav full hide-on-large-only">
          <i class="material-icons">menu</i>
        </a>
      </div>
      <ul id="slide-out" class="side-nav fixed">
        <li>
          <div class="userView">
            <div class="background"></div>
            <a href="https://fathomson.github.io" target="_blank"><img class="circle z-depth-2" src="/assets/res/user.png"></a>
            <span class="white-text name">Frank Thomson</span>
            <span class="white-text email">Data Scientist ICT Automatisering</span>
          </div>
        </li>
        <li><a class="waves-effect" href="/"><i class="material-icons">home</i>Home</a></li>
        <li><a class="waves-effect" href="/projects"><i class="material-icons">description</i>Projects</a></li>
        <li><a class="waves-effect" href="/categories"><i class="material-icons">sort</i>Categories</a></li>
        <li><a class="waves-effect" href="/about"><i class="material-icons">person</i>About</a></li>
        <li><div class="divider"></div></li>
        <li><a class="waves-effect" href="http://www.r-bloggers.com"  target="_blank">R-Bloggers</a></li>
      </ul>
    </header>
    <main>


<div class="container">
  <div id="post-info">
  <h3>R, ethereum, shinyapps - Profitability dashboard part 1 of 2</h3>
  <ul class="collapsible hoverable" data-collapsible="accordion">
    <li>
      <div class="collapsible-header">
        <span>
          <i class="material-icons tooltipped" data-position="left" data-delay="30" data-tooltip="Date">date_range</i>
          20/07/2017 12:30
          <i id="indicate" class="right material-icons tooltipped" data-position="left" data-delay="30" data-tooltip="Show extra info">info</i>
        </span>
      </div>
      <div class="collapsible-body">
        <span>
          <i class="material-icons tooltipped" data-position="left" data-delay="30" data-tooltip="Categories">sort</i>
          
          
          
          <a href="/categories#feedr" target="_blank"><div class="chip">feedR</div></a>
          
        </span>
        <span>
          <i class="material-icons tooltipped" data-position="left" data-delay="30" data-tooltip="Tags">label</i>
          
          
          
          <a href="/tags#r_cap" target="_blank"><div class="chip">R</div></a>
          
          
          
          <a href="/tags#shinyapps" target="_blank"><div class="chip">shinyapps</div></a>
          
          
          
          <a href="/tags#ethereum" target="_blank"><div class="chip">ethereum</div></a>
          
          
          
          <a href="/tags#dashboard" target="_blank"><div class="chip">dashboard</div></a>
          
        </span>
      </div>
    </li>
  </ul>
</div>
<div class="divider"></div>
<div class="row">
  <div class="col s12">
    <p><a href="https://ethereum.shinyapps.io/dashboard/"><img src="https://raw.githubusercontent.com/fathomson/fathomson.github.io/master/assets/img/dashboard.PNG" width="300px" /></a>
<br />
The cryptocurrency Ethereum now reaches the news headlines on a daily basis. It has attracted a lot of new miners who often seek a way to earn a quick buck, but how profitable is the mining of this digital currency? To find out I walk you thought the steps I took to develop a profitability calculator dashboard. It consists out of two parts, the first part focusses on the data collection and preparation and in the second part I will handle the dashboard development.</p>

<h4 id="collect-data">Collect data</h4>
<p>The first step is to get the full ether block chain to collect the data from, so I downloaded and installed <a href="https://geth.ethereum.org/downloads/">geth</a>.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#create account
</span><span class="n">geth</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="n">new</span><span class="w">

</span><span class="c1">#sync chain and start rpc
</span><span class="n">geth</span><span class="w"> </span><span class="o">--</span><span class="n">rpc</span><span class="w"> </span><span class="o">--</span><span class="n">rpccorsdomain</span><span class="w"> </span><span class="n">localhost</span><span class="w"> </span><span class="o">--</span><span class="n">cache</span><span class="o">=</span><span class="m">1024</span></code></pre></figure>

<p>This took quite a while and you could speed it up by downloading a so-called backup file of the chain which are available online. While this process runs you can already start collecting block data. Do note that the full size of the chain currently is about 60GB and counting.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></td><td class="code"><pre><span class="c1"># json rpc api functions.
# thanks to: https://github.com/BSDStudios/ethr
# json-rpc documentation: https://github.com/ethereum/wiki/wiki/JSON-RPC
</span><span class="w">
</span><span class="c1"># Returns the number of most recent block.
</span><span class="n">eth_blockNumber</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">rpc_address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://localhost:8545"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">post_body</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">jsonrpc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"2.0"</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"eth_blockNumber"</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">83</span><span class="p">)</span><span class="w">
  </span><span class="n">post_return</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">httr</span><span class="o">::</span><span class="n">POST</span><span class="p">(</span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rpc_address</span><span class="p">,</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">post_body</span><span class="p">,</span><span class="w"> </span><span class="n">encode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"json"</span><span class="p">)</span><span class="w">
  </span><span class="n">post_content</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">httr</span><span class="o">::</span><span class="n">content</span><span class="p">(</span><span class="n">post_return</span><span class="p">,</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"parsed"</span><span class="p">)</span><span class="w">
  </span><span class="n">block_number</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">post_content</span><span class="o">$</span><span class="n">result</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">block_number</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># Returns information about a block by block number.
</span><span class="n">eth_getBlockByNumber</span><span class="w"> </span><span class="o">&lt;-</span><span class="k">function</span><span class="p">(</span><span class="n">block_number</span><span class="p">,</span><span class="w"> </span><span class="n">full_list</span><span class="p">,</span><span class="w"> </span><span class="n">rpc_address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://localhost:8545"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">block_number</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">block_number</span><span class="p">)</span><span class="w">
  </span><span class="n">full_list</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.logical</span><span class="p">(</span><span class="n">full_list</span><span class="p">)</span><span class="w">
  </span><span class="n">body</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">jsonrpc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"2.0"</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"eth_getBlockByNumber"</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">block_number</span><span class="p">,</span><span class="w"> </span><span class="n">full_list</span><span class="p">),</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
  </span><span class="n">block_return</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">httr</span><span class="o">::</span><span class="n">POST</span><span class="p">(</span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rpc_address</span><span class="p">,</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">body</span><span class="p">,</span><span class="w"> </span><span class="n">encode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"json"</span><span class="p">)</span><span class="w">
  </span><span class="n">block_dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">httr</span><span class="o">::</span><span class="n">content</span><span class="p">(</span><span class="n">block_return</span><span class="p">)</span><span class="o">$</span><span class="n">result</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">block_dat</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># Returns the receipt of a transaction by transaction hash.
</span><span class="n">eth_getTransactionReceipt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">transaction_hash</span><span class="p">,</span><span class="w"> </span><span class="n">rpc_address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://localhost:8545"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">body</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">jsonrpc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"2.0"</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"eth_getTransactionReceipt"</span><span class="p">,</span><span class="w">  </span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">transaction_hash</span><span class="p">),</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
  </span><span class="n">TransReceipt_return</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">httr</span><span class="o">::</span><span class="n">POST</span><span class="p">(</span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rpc_address</span><span class="p">,</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">body</span><span class="p">,</span><span class="w"> </span><span class="n">encode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"json"</span><span class="p">)</span><span class="w">
  </span><span class="n">TransReceipt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">httr</span><span class="o">::</span><span class="n">content</span><span class="p">(</span><span class="n">TransReceipt_return</span><span class="p">)</span><span class="o">$</span><span class="n">result</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">TransReceipt</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># Returns information about a uncle of a block by number and uncle index position.
</span><span class="n">eth_getUncleByBlockNumberAndIndex</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">block_number</span><span class="p">,</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">rpc_address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"http://localhost:8545"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">body</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">jsonrpc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"2.0"</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"eth_getUncleByBlockNumberAndIndex"</span><span class="p">,</span><span class="w">  </span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">block_number</span><span class="p">,</span><span class="w"> </span><span class="n">index</span><span class="p">),</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
  </span><span class="n">UncleBlock_return</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">httr</span><span class="o">::</span><span class="n">POST</span><span class="p">(</span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rpc_address</span><span class="p">,</span><span class="w"> </span><span class="n">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">body</span><span class="p">,</span><span class="w"> </span><span class="n">encode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"json"</span><span class="p">)</span><span class="w">
  </span><span class="n">UncleBlock</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">httr</span><span class="o">::</span><span class="n">content</span><span class="p">(</span><span class="n">UncleBlock_return</span><span class="p">)</span><span class="o">$</span><span class="n">result</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">UncleBlock</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h4 id="transform-data">Transform data</h4>
<p>The data as received from the functions defined above is not directly suitable. It needs to be transformed and enriched in order to be of use. The functions below help us transforming the data.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</pre></td><td class="code"><pre><span class="c1"># hex -&gt; numeric
</span><span class="n">getNumber</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">hex</span><span class="p">){</span><span class="w">
  </span><span class="nf">class</span><span class="p">(</span><span class="n">hex</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"numeric"</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"%.0f"</span><span class="p">,</span><span class="n">hex</span><span class="p">)))</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># numeric -&gt; hex
</span><span class="n">getHex</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">  </span><span class="k">function</span><span class="p">(</span><span class="n">number</span><span class="p">){</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"0x"</span><span class="p">,</span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"%x"</span><span class="p">,</span><span class="n">number</span><span class="p">)))</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># Enrich block data with: uncle and transaction details.
</span><span class="n">enrichETHblock</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">hexBlock</span><span class="p">){</span><span class="w">

  </span><span class="c1"># default block reward, amount transactionfees and total ether of transactions in block.
</span><span class="w">  </span><span class="n">blockReward</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">5</span><span class="w">
  </span><span class="n">txFees</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w">
  </span><span class="n">ethValue</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w">

  </span><span class="c1"># sum all transactionfees
</span><span class="w">  </span><span class="k">for</span><span class="p">(</span><span class="n">transaction</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">hexBlock</span><span class="o">$</span><span class="n">transactions</span><span class="p">){</span><span class="w">    
    </span><span class="n">ethValue</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ethValue</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">getNumber</span><span class="p">(</span><span class="n">transaction</span><span class="o">$</span><span class="n">value</span><span class="p">)</span><span class="o">/</span><span class="m">1e18</span><span class="w">
    </span><span class="n">tr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">eth_getTransactionReceipt</span><span class="p">(</span><span class="n">transaction</span><span class="o">$</span><span class="n">hash</span><span class="p">)</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="nf">is.null</span><span class="p">(</span><span class="n">tr</span><span class="p">))</span><span class="w">
      </span><span class="k">next</span><span class="w">
    </span><span class="n">txFees</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">txFees</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">getNumber</span><span class="p">(</span><span class="n">tr</span><span class="o">$</span><span class="n">gasUsed</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">getNumber</span><span class="p">(</span><span class="n">transaction</span><span class="o">$</span><span class="n">gasPrice</span><span class="p">)</span><span class="o">/</span><span class="m">1e18</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">

  </span><span class="c1"># sum total uncle rewards
</span><span class="w">  </span><span class="n">uncleETH</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w">
  </span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0</span><span class="o">:</span><span class="m">1</span><span class="p">){</span><span class="w">
    </span><span class="n">uncle</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">eth_getUncleByBlockNumberAndIndex</span><span class="p">(</span><span class="n">hexBlock</span><span class="o">$</span><span class="n">number</span><span class="p">,</span><span class="n">getHex</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="w">
    </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nf">is.null</span><span class="p">(</span><span class="n">uncle</span><span class="p">))</span><span class="w">
      </span><span class="n">uncleETH</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">uncleETH</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="m">8</span><span class="o">-</span><span class="p">(</span><span class="n">getNumber</span><span class="p">(</span><span class="n">hexBlock</span><span class="o">$</span><span class="n">number</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">getNumber</span><span class="p">(</span><span class="n">uncle</span><span class="o">$</span><span class="n">number</span><span class="p">)))</span><span class="o">/</span><span class="m">8</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">blockReward</span><span class="w">
  </span><span class="p">}</span><span class="w">

  </span><span class="c1"># miner reward for included uncle
</span><span class="w">  </span><span class="n">minerRewardUncle</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">hexBlock</span><span class="o">$</span><span class="n">uncles</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="m">32</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">blockReward</span><span class="w">

  </span><span class="c1"># wrap in dataframe
</span><span class="w">  </span><span class="n">block</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getNumber</span><span class="p">(</span><span class="n">hexBlock</span><span class="o">$</span><span class="n">number</span><span class="p">),</span><span class="w">
                      </span><span class="n">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.POSIXct</span><span class="p">(</span><span class="n">getNumber</span><span class="p">(</span><span class="n">hexBlock</span><span class="o">$</span><span class="n">timestamp</span><span class="p">),</span><span class="w"> </span><span class="n">origin</span><span class="o">=</span><span class="s2">"1970-01-01"</span><span class="p">),</span><span class="w">
                      </span><span class="n">difficulty</span><span class="o">=</span><span class="w">  </span><span class="n">getNumber</span><span class="p">(</span><span class="n">hexBlock</span><span class="o">$</span><span class="n">difficulty</span><span class="p">),</span><span class="w">
                      </span><span class="n">txCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">hexBlock</span><span class="o">$</span><span class="n">transactions</span><span class="p">),</span><span class="w">
                      </span><span class="n">txEther</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ethValue</span><span class="p">,</span><span class="w">
                      </span><span class="n">txFees</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">txFees</span><span class="p">,</span><span class="w">
                      </span><span class="n">uncleETH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uncleETH</span><span class="p">,</span><span class="w">
                      </span><span class="n">minerUncleReward</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">minerRewardUncle</span><span class="p">,</span><span class="w">
                      </span><span class="n">totalETHreward</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">blockReward</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">txFees</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">minerRewardUncle</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">uncleETH</span><span class="p">)</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">block</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h4 id="save-data">Save data</h4>
<p>Ok, now we have collected the data and we can transform it into the format we want. The next step is saving the transformed data for our future analysis. I have chosen for a local instance of SQL to write the data to. If you do not have an instance of SQL on your machine download it and create a database add a table.  I have named my table eth_blocks and it can be created with the following statement:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">eth_blocks</span><span class="p">(</span>
	<span class="p">[</span><span class="n">number</span><span class="p">]</span> <span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="p">[</span><span class="k">timestamp</span><span class="p">]</span> <span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="p">[</span><span class="n">difficulty</span><span class="p">]</span> <span class="p">[</span><span class="n">bigint</span><span class="p">]</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="p">[</span><span class="n">txCount</span><span class="p">]</span> <span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="p">[</span><span class="n">txEther</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">24</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="p">[</span><span class="n">txFees</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">24</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="p">[</span><span class="n">uncleETH</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">24</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="p">[</span><span class="n">minerUncleReward</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">24</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="p">[</span><span class="n">totalETHreward</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">24</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="k">NULL</span>
<span class="p">)</span></code></pre></figure>

<p>Once the table is created we need to be able to write the data from R into SQL. The are two beautiful R libraries available to help us achieve that namely:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">RODBC</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">RODBCext</span><span class="p">)</span><span class="w"> </span><span class="c1"># parameterizes queries
</span><span class="w">
</span><span class="c1"># Define an ODBC datasource and you can easily connect to your database
</span><span class="n">dbHandle</span><span class="w"> </span><span class="o">&lt;-</span><span class="n">odbcConnect</span><span class="p">(</span><span class="s2">"[database-name]"</span><span class="p">)</span></code></pre></figure>

<p>Once everything is set up we can start the script that actually collects the data, transforms it and finally saves it into the database.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69</pre></td><td class="code"><pre><span class="c1"># script start time
</span><span class="n">start.time</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Sys.time</span><span class="p">()</span><span class="w">

</span><span class="c1"># create database handle ODBS data source
</span><span class="n">dbHandle</span><span class="w"> </span><span class="o">&lt;-</span><span class="n">odbcConnect</span><span class="p">(</span><span class="s2">"ethereum"</span><span class="p">)</span><span class="w">

</span><span class="c1"># get the latest block in database
</span><span class="n">maxBlockInDB</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sqlQuery</span><span class="p">(</span><span class="n">dbHandle</span><span class="p">,</span><span class="w"> </span><span class="s2">"select top 1 number from eth_blocks order by number desc"</span><span class="p">)</span><span class="w">
</span><span class="n">maxBlockInDB</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">maxBlockInDB</span><span class="p">)</span><span class="w">

</span><span class="c1"># when no block is found, assume that there are no block in the db yet
</span><span class="k">if</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">maxBlockInDB</span><span class="p">[</span><span class="m">1</span><span class="p">]))</span><span class="w">
  </span><span class="n">maxBlockInDB</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="w">

</span><span class="c1"># start block is latest block in db + 1
</span><span class="n">startBlock</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">maxBlockInDB</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="w">

</span><span class="c1"># stop block is last block in chain
</span><span class="n">stopBlock</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">getNumber</span><span class="p">(</span><span class="n">eth_blockNumber</span><span class="p">())</span><span class="w">

</span><span class="c1"># blocks that will be added in this session. 1 when stopblock and startblok are equal.
</span><span class="n">print</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"Starting update operation, blocks to add: : "</span><span class="p">,</span><span class="n">stopBlock</span><span class="w"> </span><span class="o">-</span><span class="n">maxBlockInDB</span><span class="w"> </span><span class="p">))</span><span class="w">

</span><span class="c1"># get new blocks from chain and write to database    
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">startBlock</span><span class="o">:</span><span class="n">stopBlock</span><span class="p">){</span><span class="w">
  </span><span class="c1"># get block i from chain
</span><span class="w">  </span><span class="n">block</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">eth_getBlockByNumber</span><span class="p">(</span><span class="n">getHex</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
  </span><span class="k">if</span><span class="p">(</span><span class="nf">is.null</span><span class="p">(</span><span class="n">block</span><span class="p">))</span><span class="w">
    </span><span class="k">break</span><span class="w">

  </span><span class="c1"># convert to database format and save in database.
</span><span class="w">  </span><span class="n">rBlock</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">enrichETHblock</span><span class="p">(</span><span class="n">block</span><span class="p">)</span><span class="w">
  </span><span class="n">RODBCext</span><span class="o">::</span><span class="n">sqlExecute</span><span class="p">(</span><span class="n">dbHandle</span><span class="p">,</span><span class="w"> </span><span class="s2">"INSERT INTO eth_blocks VALUES (?,?,?,?,?,?,?,?,?)"</span><span class="p">,</span><span class="w"> </span><span class="n">rBlock</span><span class="p">)</span><span class="w">

  </span><span class="c1"># once every 500 blocks show status messuge
</span><span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="m">500</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">){</span><span class="w">
    </span><span class="n">end.time</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Sys.time</span><span class="p">()</span><span class="w">
    </span><span class="n">time.taken</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">end.time</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start.time</span><span class="w">
    </span><span class="n">print</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"Current block : "</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="s2">" Operation took:"</span><span class="p">,</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">time.taken</span><span class="p">)</span><span class="w">   </span><span class="p">))</span><span class="w">
    </span><span class="n">start.time</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Sys.time</span><span class="p">()</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="c1"># when done show status message again.
</span><span class="n">print</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"Done! added: : "</span><span class="p">,</span><span class="n">stopBlock</span><span class="w"> </span><span class="o">-</span><span class="n">maxBlockInDB</span><span class="p">,</span><span class="s2">" blocks"</span><span class="w"> </span><span class="p">))</span><span class="w">

</span><span class="c1"># when done retrieve all blocks from the database
</span><span class="n">allBlocks</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sqlQuery</span><span class="p">(</span><span class="n">dbHandle</span><span class="p">,</span><span class="w"> </span><span class="s2">"select * from eth_blocks order by number asc"</span><span class="p">)</span><span class="w">

</span><span class="c1"># aggregate block data
</span><span class="n">dailyDifficulty</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">allBlocks</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">mutate</span><span class="p">(</span><span class="n">toTimestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dplyr</span><span class="o">::</span><span class="n">lead</span><span class="p">(</span><span class="n">timestamp</span><span class="p">))</span><span class="w">   </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">mutate</span><span class="p">(</span><span class="n">duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">difftime</span><span class="p">(</span><span class="n">toTimestamp</span><span class="p">,</span><span class="n">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"secs"</span><span class="p">)))</span><span class="w">   </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">mutate</span><span class="p">(</span><span class="n">weigthedDifficulty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">difficulty</span><span class="o">*</span><span class="n">duration</span><span class="p">)</span><span class="w">   </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">group_by</span><span class="p">(</span><span class="n">Day</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.Date</span><span class="p">(</span><span class="n">format</span><span class="p">(</span><span class="n">as.Date</span><span class="p">(</span><span class="n">timestamp</span><span class="p">,</span><span class="w"> </span><span class="s2">"%d/%m/%Y"</span><span class="p">))))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">summarise</span><span class="p">(</span><span class="n">netHash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">weigthedDifficulty</span><span class="p">)</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">duration</span><span class="p">),</span><span class="w">
                   </span><span class="n">avgBlocktime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">duration</span><span class="p">),</span><span class="w">
                   </span><span class="n">ethFromBlocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">()</span><span class="o">*</span><span class="m">5</span><span class="p">,</span><span class="w">
                   </span><span class="n">ethFromUnclesForMiner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">uncleETH</span><span class="p">),</span><span class="w">
                   </span><span class="n">ethFromUnclesForIncluder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">minerUncleReward</span><span class="p">),</span><span class="w">
                   </span><span class="n">ethFromtxFees</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">txFees</span><span class="p">),</span><span class="w">
                   </span><span class="n">ethTotal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">ethFromBlocks</span><span class="p">,</span><span class="n">ethFromUnclesForMiner</span><span class="p">,</span><span class="n">ethFromUnclesForIncluder</span><span class="p">,</span><span class="n">ethFromtxFees</span><span class="p">))</span><span class="w">

</span><span class="c1"># RStudio filedir
# write to dashboard dir
</span><span class="n">dir</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dirname</span><span class="p">(</span><span class="n">rstudioapi</span><span class="o">::</span><span class="n">getActiveDocumentContext</span><span class="p">()</span><span class="o">$</span><span class="n">path</span><span class="p">)</span><span class="w">
</span><span class="n">saveRDS</span><span class="p">(</span><span class="n">dailyDifficulty</span><span class="p">,</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span><span class="w"> </span><span class="s2">"/dashboard/data/daily.Rda"</span><span class="p">))</span><span class="w">

</span><span class="c1"># clode db connection
</span><span class="n">odbcCloseAll</span><span class="p">()</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>As you notice in the end I save the aggregated data file (daily.Rda) in a separate folder. This data file will be used for our dashboard which I discuss in part 2.</p>

<h5 id="useful-links">Useful links</h5>
<p><a href="https://github.com/fathomson/Ether-mining-profitability-calculator">Project source code</a><br />
<a href="https://github.com/fathomson/Ether-mining-profitability-calculator/issues">Report issues</a><br />
<a href="https://www.linkedin.com/in/fathomson/">Questions/contact</a></p>

  </div>
</div>

<div id="disqus_thread"></div>
<script>
  var disqus_config = function () {
    this.page.url = "http://localhost:4000/2017/07/20/R,-shinyapps,-ethereum-Profitability-dashboard-part-1of2";
    this.page.identifier = "/2017/07/20/R, shinyapps, ethereum - Profitability dashboard part 1of2";
  };
  (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = '//fathomson.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

</div>

    </main>
    <footer class="page-footer light-blue darken-4">
      <div class="container">
        <div class="row">
          <div class="col s12">
            <p class="grey-text text-lighten-4">This site is used for hobby projects about which I write now and then.</p>
          </div>
        </div>
      </div>
      <div class="footer-copyright">
        <div class="container">
          &#xA9; 2017 Technical blog about R, block chain and more. All rights reserved. Theme by <a href="https://github.com/ShawnTeoh/matjek">MatJek</a>.
        </div>
      </div>
    </footer>
    <script src="//code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/materialize/0.99.0/js/materialize.min.js"></script>
    
    
    <script src="/assets/js/post.js"></script>
    
    
    
    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})
      (window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-101946097-1', 'auto');
      ga('send', 'pageview');
    </script>
    
    <script src="/assets/js/main.js"></script>
  </body>
</html>
